<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Momentum Leaderboard | Inertia</title>
        <meta name="description" content="Beta tester leaderboard for Inertia. See top contributors across tournaments, combo building, and bug hunting.">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
        <!-- External Stylesheets -->
        <link href="css/design-tokens.css" rel="stylesheet" type="text/css">
        <link href="css/utilities.css" rel="stylesheet" type="text/css">
        <link href="css/mvp.css" rel="stylesheet" type="text/css">
        <link href="css/animations.css" rel="stylesheet" type="text/css">
        <!-- Supabase JS Client -->
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <!-- Alpine.js -->
        <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/intersect@3.x.x/dist/cdn.min.js"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
        <style>
            /* Leaderboard-specific styles */
            .tab-button {
                padding: 0.75rem 1.25rem;
                font-size: 0.875rem;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                border-radius: 0.5rem;
                transition: all 0.3s ease;
                background: transparent;
                border: 1px solid transparent;
                color: rgba(245, 245, 245, 0.6);
                cursor: pointer;
            }
            .tab-button:hover {
                color: var(--cyan);
                background: rgba(0, 229, 255, 0.05);
            }
            .tab-button.active {
                color: var(--cyan);
                border-color: rgba(0, 229, 255, 0.3);
                background: rgba(0, 229, 255, 0.1);
            }
            .leaderboard-row {
                display: grid;
                grid-template-columns: 60px 1fr 100px;
                align-items: center;
                padding: 1rem 1.5rem;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
                transition: background 0.2s ease;
            }
            .leaderboard-row:hover {
                background: rgba(0, 229, 255, 0.03);
            }
            .leaderboard-row.top-3 {
                background: rgba(255, 215, 0, 0.03);
            }
            .leaderboard-row.top-3:hover {
                background: rgba(255, 215, 0, 0.06);
            }
            .rank-badge {
                width: 36px;
                height: 36px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 50%;
                font-weight: 500;
                font-size: 0.875rem;
            }
            .rank-1 { background: linear-gradient(135deg, #FFD700, #FFA500); color: #000; }
            .rank-2 { background: linear-gradient(135deg, #C0C0C0, #A0A0A0); color: #000; }
            .rank-3 { background: linear-gradient(135deg, #CD7F32, #8B4513); color: #fff; }
            .rank-default { background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.6); }
            .search-input {
                background: rgba(26, 31, 46, 0.8);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 0.5rem;
                padding: 0.875rem 1rem 0.875rem 3rem;
                color: var(--frost);
                width: 100%;
                max-width: 400px;
                font-size: 1rem;
                transition: all 0.3s ease;
            }
            .search-input:focus {
                outline: none;
                border-color: var(--cyan);
                box-shadow: 0 0 0 3px rgba(0, 229, 255, 0.1);
            }
            .search-input::placeholder {
                color: rgba(255, 255, 255, 0.4);
            }
            .skeleton {
                background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
                background-size: 200% 100%;
                animation: shimmer 1.5s infinite;
                border-radius: 0.25rem;
            }
            @keyframes shimmer {
                0% { background-position: 200% 0; }
                100% { background-position: -200% 0; }
            }
            .category-description {
                font-size: 0.75rem;
                color: rgba(255, 255, 255, 0.5);
                margin-top: 0.25rem;
            }
            .points-value {
                font-variant-numeric: tabular-nums;
            }
            .highlight-row {
                background: rgba(0, 229, 255, 0.1) !important;
                border-left: 3px solid var(--cyan);
            }
        </style>
    </head>
    <body>
        <div class="min-h-screen" x-data="leaderboardApp()" x-init="init()">
            <!-- NAVIGATION -->
            <nav class="fixed top-0 w-full z-50 transition-all duration-300" style="background-color: rgba(10, 10, 10, 0.9); backdrop-filter: blur(10px);">
                <div class="max-w-7xl mx-auto px-6">
                    <div class="flex justify-between items-center h-16">
                        <a href="/" class="flex items-center"> <span class="text-2xl font-thin tracking-widest text-frost">INERTIA</span> </a>
                        <div class="hidden md:flex items-center space-x-8">
                            <div class="relative" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                                <button class="text-gray-200 text-opacity-70 hover:text-cyan transition-colors text-sm tracking-wider uppercase flex items-center gap-1" style="background: transparent !important; border: none !important; padding: 0; cursor: pointer;">
                                    Products
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div x-show="open" x-transition class="absolute left-0 mt-2 w-48 rounded-lg bg-steel border border-cyan-500 border-opacity-20 shadow-lg overflow-hidden" style="display: none;">
                                    <a href="/products/app.html" class="block px-4 py-3 text-sm text-gray-200 hover:bg-cyan-500 hover:bg-opacity-10 hover:text-cyan transition-colors">Inertia App</a>
                                    <a href="/products/insight.html" class="block px-4 py-3 text-sm text-gray-200 hover:bg-cyan-500 hover:bg-opacity-10 hover:text-cyan transition-colors">Insight</a>
                                    <a href="/products/axis.html" class="block px-4 py-3 text-sm text-gray-200 hover:bg-cyan-500 hover:bg-opacity-10 hover:text-cyan transition-colors">Axis</a>
                                </div>
                            </div>
                            <a href="/platform.html" class="text-gray-200 text-opacity-70 hover:text-cyan transition-colors text-sm tracking-wider uppercase" style="text-decoration: none;">Platform</a>
                            <a href="/leaderboard.html" class="text-cyan text-sm tracking-wider uppercase" style="text-decoration: none;">Leaderboard</a>
                            <a href="/theorycrafting.html" class="text-gray-200 text-opacity-70 hover:text-cyan transition-colors text-sm tracking-wider uppercase" style="text-decoration: none;">Theorycrafting</a>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- HERO SECTION -->
            <section class="relative pt-32 pb-12" x-data="{ loaded: false }" x-init="setTimeout(() => loaded = true, 200)">
                <div class="container max-w-4xl mx-auto px-6 text-center">
                    <h1 class="text-5xl sm:text-6xl md:text-7xl font-thin tracking-widest mb-6" x-show="loaded" x-transition>
                        LEADERBOARD
                    </h1>
                    <p class="text-xl sm:text-2xl text-cyan font-light tracking-wide mb-4" x-show="loaded" x-transition>
                        Momentum Points Rankings
                    </p>
                    <p class="text-lg text-gray-300 text-opacity-80 max-w-2xl mx-auto" x-show="loaded" x-transition>
                        Beta testers earning points across tournaments, combo building, and community contributions.
                    </p>
                </div>
            </section>

            <!-- SEARCH BAR -->
            <section class="pb-8">
                <div class="container max-w-4xl mx-auto px-6">
                    <div class="relative max-w-md mx-auto">
                        <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <input
                            type="text"
                            class="search-input w-full"
                            placeholder="Search by username..."
                            x-model="searchQuery"
                            @input="filterResults()"
                        >
                    </div>
                </div>
            </section>

            <!-- CATEGORY TABS -->
            <section class="pb-8">
                <div class="container max-w-4xl mx-auto px-6">
                    <div class="flex flex-wrap justify-center gap-2">
                        <button
                            class="tab-button"
                            :class="{ 'active': activeCategory === 'overall' }"
                            @click="setCategory('overall')"
                        >
                            Overall
                        </button>
                        <button
                            class="tab-button"
                            :class="{ 'active': activeCategory === 'organizer' }"
                            @click="setCategory('organizer')"
                        >
                            Organizers
                        </button>
                        <button
                            class="tab-button"
                            :class="{ 'active': activeCategory === 'competitor' }"
                            @click="setCategory('competitor')"
                        >
                            Competitors
                        </button>
                        <button
                            class="tab-button"
                            :class="{ 'active': activeCategory === 'builder' }"
                            @click="setCategory('builder')"
                        >
                            Builders
                        </button>
                        <button
                            class="tab-button"
                            :class="{ 'active': activeCategory === 'bug_hunter' }"
                            @click="setCategory('bug_hunter')"
                        >
                            Bug Hunters
                        </button>
                    </div>
                    <!-- Category Description -->
                    <p class="text-center text-gray-500 text-sm mt-4" x-text="getCategoryDescription()"></p>
                </div>
            </section>

            <!-- LEADERBOARD TABLE -->
            <section class="py-8">
                <div class="container max-w-4xl mx-auto px-6">
                    <div class="card overflow-hidden" style="padding: 0;">
                        <!-- Table Header -->
                        <div class="leaderboard-row" style="background: rgba(0, 0, 0, 0.3); border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <div class="text-xs text-gray-500 uppercase tracking-wider">Rank</div>
                            <div class="text-xs text-gray-500 uppercase tracking-wider">Player</div>
                            <div class="text-xs text-gray-500 uppercase tracking-wider text-right">Points</div>
                        </div>

                        <!-- Loading State -->
                        <template x-if="loading">
                            <div>
                                <template x-for="i in 10" :key="i">
                                    <div class="leaderboard-row">
                                        <div class="skeleton" style="width: 36px; height: 36px; border-radius: 50%;"></div>
                                        <div class="skeleton" style="width: 60%; height: 20px;"></div>
                                        <div class="skeleton" style="width: 60px; height: 20px; margin-left: auto;"></div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- Error State -->
                        <template x-if="error && !loading">
                            <div class="py-16 text-center">
                                <div class="text-4xl mb-4 opacity-40">!</div>
                                <p class="text-gray-400 mb-2">Unable to load leaderboard</p>
                                <p class="text-gray-500 text-sm mb-6" x-text="error"></p>
                                <button @click="fetchData()" class="cta-secondary px-6 py-2 text-sm">Try Again</button>
                            </div>
                        </template>

                        <!-- Empty State -->
                        <template x-if="!loading && !error && filteredData.length === 0">
                            <div class="py-16 text-center">
                                <div class="text-4xl mb-4 opacity-40">?</div>
                                <template x-if="searchQuery">
                                    <div>
                                        <p class="text-gray-400 mb-2">No results for "<span x-text="searchQuery"></span>"</p>
                                        <p class="text-gray-500 text-sm">Try a different username</p>
                                    </div>
                                </template>
                                <template x-if="!searchQuery">
                                    <div>
                                        <p class="text-gray-400 mb-2">No data for this category yet</p>
                                        <p class="text-gray-500 text-sm">Check back soon!</p>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- Leaderboard Rows -->
                        <template x-if="!loading && !error && filteredData.length > 0">
                            <div>
                                <template x-for="(entry, index) in filteredData" :key="entry.user_id">
                                    <div
                                        class="leaderboard-row"
                                        :class="{
                                            'top-3': entry.rank <= 3,
                                            'highlight-row': searchQuery && entry.username.toLowerCase().includes(searchQuery.toLowerCase())
                                        }"
                                    >
                                        <!-- Rank -->
                                        <div>
                                            <div
                                                class="rank-badge"
                                                :class="{
                                                    'rank-1': entry.rank === 1,
                                                    'rank-2': entry.rank === 2,
                                                    'rank-3': entry.rank === 3,
                                                    'rank-default': entry.rank > 3
                                                }"
                                                x-text="entry.rank"
                                            ></div>
                                        </div>
                                        <!-- Username -->
                                        <div class="text-gray-200 font-light" x-text="entry.username"></div>
                                        <!-- Points -->
                                        <div class="text-right">
                                            <span class="text-cyan points-value" x-text="formatPoints(entry.category_total)"></span>
                                            <span class="text-gray-500 text-sm ml-1">MP</span>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>
                    </div>

                    <!-- Last Updated -->
                    <p class="text-center text-gray-600 text-xs mt-4" x-show="lastUpdated">
                        Last updated: <span x-text="lastUpdated"></span>
                    </p>
                </div>
            </section>

            <!-- HOW TO EARN POINTS -->
            <section class="py-16">
                <div class="container max-w-4xl mx-auto px-6">
                    <h2 class="text-3xl font-thin tracking-wider text-center mb-12">How to Earn Points</h2>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="card">
                            <h3 class="text-lg text-cyan mb-3 font-light">Run Tournaments</h3>
                            <p class="text-gray-400 text-sm mb-3">Organize tournaments using the Inertia App. More players = more points.</p>
                            <p class="text-gray-500 text-xs">30-75 base + 50/logged-in player</p>
                        </div>
                        <div class="card">
                            <h3 class="text-lg text-cyan mb-3 font-light">Compete</h3>
                            <p class="text-gray-400 text-sm mb-3">Participate in tournaments, win matches, log your battles.</p>
                            <p class="text-gray-500 text-xs">25 pts participation + win bonuses</p>
                        </div>
                        <div class="card">
                            <h3 class="text-lg text-cyan mb-3 font-light">Build Combos</h3>
                            <p class="text-gray-400 text-sm mb-3">Create and save combos in the Workshop.</p>
                            <p class="text-gray-500 text-xs">5 pts per combo (10/week cap)</p>
                        </div>
                        <div class="card">
                            <h3 class="text-lg text-cyan mb-3 font-light">Report Bugs</h3>
                            <p class="text-gray-400 text-sm mb-3">Find issues, report them, help us improve.</p>
                            <p class="text-gray-500 text-xs">25-250 pts based on severity</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CTA -->
            <section class="py-16 bg-black bg-opacity-30">
                <div class="container max-w-2xl mx-auto px-6 text-center">
                    <h2 class="text-3xl font-thin tracking-wider mb-6">Join the Beta</h2>
                    <p class="text-gray-400 mb-8">Download the Inertia App and start earning Momentum Points today.</p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <a href="https://testflight.apple.com/join/915pq6mg" target="_blank" class="cta-primary px-8 py-3">iOS (TestFlight)</a>
                        <a href="https://drive.proton.me/urls/23QXPAM8ZM#5sYHIuFPJ0vt" target="_blank" class="cta-secondary px-8 py-3">Android (APK)</a>
                    </div>
                </div>
            </section>

            <!-- FOOTER -->
            <footer class="relative py-12 border-t border-gray-800 border-opacity-30">
                <div class="container">
                    <div class="flex flex-col md:flex-row justify-between items-center text-center md:text-left">
                        <div class="mb-4 md:mb-0">
                            <h3 class="text-2xl font-thin tracking-widest mb-2">INERTIA</h3>
                            <p class="text-sm text-muted">Â© 2025. All rights reserved.</p>
                        </div>
                        <div class="flex space-x-8">
                            <a href="/404.html" class="text-sm text-muted hover:text-cyan transition-colors">Privacy</a>
                            <a href="/404.html" class="text-sm text-muted hover:text-cyan transition-colors">Terms</a>
                            <a href="mailto:contact@inertia.cx" class="text-sm text-muted hover:text-cyan transition-colors">Contact</a>
                        </div>
                    </div>
                </div>
            </footer>
        </div>

        <script>
            // =================================================================
            // SUPABASE CONFIGURATION
            // =================================================================
            // TODO: Replace with your production anon key
            const SUPABASE_URL = 'https://mfggfvkyvfyjqgztggai.supabase.co';
            const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY_HERE';

            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            // =================================================================
            // ALPINE.JS APP
            // =================================================================
            function leaderboardApp() {
                return {
                    // State
                    activeCategory: 'overall',
                    searchQuery: '',
                    loading: true,
                    error: null,
                    lastUpdated: null,

                    // Data storage
                    allData: {},
                    filteredData: [],

                    // Category descriptions
                    descriptions: {
                        overall: 'Total Momentum Points from all activities',
                        organizer: 'Points earned from running tournaments',
                        competitor: 'Points from tournament participation, wins, and matches',
                        builder: 'Points from creating combos in the Workshop',
                        bug_hunter: 'Points from bug reports and feedback'
                    },

                    // Initialize
                    async init() {
                        await this.fetchData();
                    },

                    // Fetch all leaderboard data
                    async fetchData() {
                        this.loading = true;
                        this.error = null;

                        try {
                            // Fetch all categories in parallel
                            const [overall, organizer, competitor, builder, bugHunter] = await Promise.all([
                                supabaseClient.rpc('get_momentum_leaderboard', { p_limit: 50 }),
                                supabaseClient.rpc('get_organizer_leaderboard', { p_limit: 50 }),
                                supabaseClient.rpc('get_competitor_leaderboard', { p_limit: 50 }),
                                supabaseClient.rpc('get_builder_leaderboard', { p_limit: 50 }),
                                supabaseClient.rpc('get_bug_hunter_leaderboard', { p_limit: 50 })
                            ]);

                            // Check for errors
                            if (overall.error) throw overall.error;
                            if (organizer.error) throw organizer.error;
                            if (competitor.error) throw competitor.error;
                            if (builder.error) throw builder.error;
                            if (bugHunter.error) throw bugHunter.error;

                            // Map overall data to match category format
                            const overallMapped = (overall.data || []).map(entry => ({
                                ...entry,
                                category_total: entry.total_points
                            }));

                            // Store data
                            this.allData = {
                                overall: overallMapped,
                                organizer: organizer.data || [],
                                competitor: competitor.data || [],
                                builder: builder.data || [],
                                bug_hunter: bugHunter.data || []
                            };

                            // Update filtered data
                            this.filterResults();

                            // Set last updated
                            this.lastUpdated = new Date().toLocaleString();

                        } catch (err) {
                            console.error('Leaderboard fetch error:', err);
                            this.error = err.message || 'Failed to load data';

                            // Use demo data for development
                            if (SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY_HERE') {
                                this.useDemoData();
                            }
                        } finally {
                            this.loading = false;
                        }
                    },

                    // Demo data for development/testing
                    useDemoData() {
                        this.error = null;
                        const demoUsers = [
                            { user_id: '1', username: 'ThunderBlader', rank: 1, category_total: 2450 },
                            { user_id: '2', username: 'StormPilot', rank: 2, category_total: 1820 },
                            { user_id: '3', username: 'VortexKing', rank: 3, category_total: 1650 },
                            { user_id: '4', username: 'SpinMaster99', rank: 4, category_total: 1340 },
                            { user_id: '5', username: 'BurstQueen', rank: 5, category_total: 1120 },
                            { user_id: '6', username: 'MetalFury', rank: 6, category_total: 980 },
                            { user_id: '7', username: 'PhoenixRiser', rank: 7, category_total: 875 },
                            { user_id: '8', username: 'DragonSlayer', rank: 8, category_total: 720 },
                            { user_id: '9', username: 'CobraStrike', rank: 9, category_total: 650 },
                            { user_id: '10', username: 'WolfFang', rank: 10, category_total: 580 }
                        ];

                        this.allData = {
                            overall: demoUsers,
                            organizer: demoUsers.slice(0, 5).map((u, i) => ({...u, rank: i+1, category_total: Math.floor(u.category_total * 0.4)})),
                            competitor: demoUsers.slice(2, 8).map((u, i) => ({...u, rank: i+1, category_total: Math.floor(u.category_total * 0.5)})),
                            builder: demoUsers.slice(1, 7).map((u, i) => ({...u, rank: i+1, category_total: Math.floor(u.category_total * 0.2)})),
                            bug_hunter: demoUsers.slice(4, 9).map((u, i) => ({...u, rank: i+1, category_total: Math.floor(u.category_total * 0.1)}))
                        };

                        this.filterResults();
                        this.lastUpdated = 'Demo Mode';
                    },

                    // Set active category
                    setCategory(category) {
                        this.activeCategory = category;
                        this.filterResults();
                    },

                    // Get category description
                    getCategoryDescription() {
                        return this.descriptions[this.activeCategory] || '';
                    },

                    // Filter results by search query
                    filterResults() {
                        const data = this.allData[this.activeCategory] || [];

                        if (!this.searchQuery) {
                            this.filteredData = data;
                            return;
                        }

                        const query = this.searchQuery.toLowerCase();
                        this.filteredData = data.filter(entry =>
                            entry.username.toLowerCase().includes(query)
                        );
                    },

                    // Format points with commas
                    formatPoints(points) {
                        return new Intl.NumberFormat().format(points || 0);
                    }
                };
            }
        </script>
    </body>
</html>
